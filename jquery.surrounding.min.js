(function(e){e.fn.surround=function(t){function i(){if(!r.hasClass("surroundingFullscreen")){var n=r.offset();r.clone().appendTo("body").addClass("surroundingFullscreen").css({opacity:0,position:"fixed",width:r.width()+"px",left:n.left,margin:0,top:n.top-e(document).scrollTop()}).animate({"background-position":0,width:"100%",height:"100%",top:0,left:0,border:0,opacity:1},500,function(){jQuery(this).surround(t)});window.location.hash="surroundingFullscreen"}else{r.animate({opacity:0},500,function(){r.remove()});var i=document.body.scrollTop;window.location.href="#";document.body.scrollTop=i}}function s(){if(!window.location.hash){e(".surroundingFullscreen").animate({opacity:0},500,function(){e(this).remove()})}}var n=e(this).find("img:first").hide();var r=e(this);if(!t){t=new Object}if(!t.source){t.source=n.attr("src")}if(!t.step){t.step=20}e(this).css({background:"url("+t.source+")","background-size":"auto 100%",cursor:"pointer"});e(this).mousewheel(function(n,r){var i=parseInt(e(this).css("background-position").split(" ")[0].replace("px",""));e(this).css("background-position",i+r*t.step+"px");n.preventDefault()});if("onhashchange"in window){window.onhashchange=s}e(document).keydown(function(t){if(t.keyCode==27){e(".surroundingFullscreen").animate({opacity:0},500,function(){e(this).remove()})}});e(this).on("dblclick",function(){i()});var o=0;var u;e(this).bind("touchstart mousedown",function(t){t.preventDefault();if(t.type=="touchstart"){var n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];o=n.pageX;var r=(new Date).getTime();var s=e(this).data("lastTouch")||r+1;var a=r-s;u=window.setTimeout(function(){i()},1e3);if(a<500&&a>0){e(this).data("lastTouch",null);i()}else{e(this).data("lastTouch",r)}}else{o=t.pageX}e(this).css({cursor:"w-resize"})});e(this).bind("touchmove mousemove",function(t){t.preventDefault();if(o!=0){var n;if(t.type=="touchmove"){var r=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];n=o-r.pageX;o=r.pageX;if(n!=0){clearTimeout(u)}}else{n=o-t.pageX;o=t.pageX}var i=parseInt(e(this).css("background-position").split(" ")[0].replace("px",""));e(this).css("background-position",i-n+"px")}});e(this).bind("touchend mouseup mouseleave",function(t){t.preventDefault();clearTimeout(u);o=0;e(this).css({cursor:"pointer"})})}})(jQuery)