(function(e){e.fn.surround=function(t){function i(){if(!r.hasClass("surroundingFullscreen")){r.clone().appendTo("body").addClass("surroundingFullscreen").css({position:"fixed",top:0,left:0,margin:0,border:0}).animate({width:"100%",height:"100%"},500,function(){jQuery(this).surround(t)});window.location.hash="surroundingFullscreen"}else{r.animate({opacity:0},500,function(){r.remove()});var e=document.body.scrollTop;window.location.href="#";document.body.scrollTop=e}}function s(){if(!window.location.hash){e(".surroundingFullscreen").animate({opacity:0},500,function(){e(this).remove()})}}var n=e(this).find("img:first").hide();var r=e(this);if(!t){t=new Object;t.source=n.attr("src")}e(this).css({background:"url("+t.source+")","background-size":"auto 100%",cursor:"pointer"});e(this).mousewheel(function(t,n){var r=parseInt(e(this).css("background-position").split(" ")[0].replace("px",""));e(this).css("background-position",r+n*30+"px");t.preventDefault()});if("onhashchange"in window){window.onhashchange=s}e(this).on("dblclick",function(){i()});var o=0;var u;e(this).bind("touchstart mousedown",function(t){t.preventDefault();if(t.type=="touchstart"){var n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];o=n.pageX;var r=(new Date).getTime();var s=e(this).data("lastTouch")||r+1;var a=r-s;u=window.setTimeout(function(){i()},1e3);if(a<500&&a>0){e(this).data("lastTouch",null);i()}else{e(this).data("lastTouch",r)}}else{o=t.pageX}e(this).css({cursor:"w-resize"})});e(this).bind("touchmove mousemove",function(t){t.preventDefault();if(o!=0){var n;if(t.type=="touchmove"){var r=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];n=o-r.pageX;o=r.pageX;if(n!=0){clearTimeout(u)}}else{n=o-t.pageX;o=t.pageX}var i=parseInt(e(this).css("background-position").split(" ")[0].replace("px",""));e(this).css("background-position",i-n+"px")}});e(this).bind("touchend mouseup mouseleave",function(t){t.preventDefault();clearTimeout(u);o=0;e(this).css({cursor:"pointer"})})}})(jQuery)